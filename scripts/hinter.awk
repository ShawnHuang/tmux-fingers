BEGIN {
  n_matches = 0;
  HINTS[0] = "p"
  HINTS[1] = "o"
  HINTS[2] = "i"
  HINTS[3] = "u"
  HINTS[4] = "l"
  HINTS[5] = "k"
  HINTS[6] = "j"
  HINTS[7] = "t"
  HINTS[8] = "r"
  HINTS[9] = "e"
  HINTS[10] = "aa"
  HINTS[11] = "ab"
  HINTS[12] = "ac"
  HINTS[13] = "ad"
  HINTS[14] = "af"
  HINTS[15] = "ag"
  HINTS[16] = "ah"
  HINTS[17] = "am"
  HINTS[18] = "an"
  HINTS[19] = "aq"
  HINTS[20] = "as"
  HINTS[21] = "av"
  HINTS[22] = "aw"
  HINTS[23] = "ax"
  HINTS[24] = "ay"
  HINTS[25] = "az"
  HINTS[26] = "ba"
  HINTS[27] = "bb"
  HINTS[28] = "bc"
  HINTS[29] = "bd"
  HINTS[30] = "bf"
  HINTS[31] = "bg"
  HINTS[32] = "bh"
  HINTS[33] = "bm"
  HINTS[34] = "bn"
  HINTS[35] = "bq"
  HINTS[36] = "bs"
  HINTS[37] = "bv"
  HINTS[38] = "bw"
  HINTS[39] = "bx"
  HINTS[40] = "by"
  HINTS[41] = "bz"
  HINTS[42] = "ca"
  HINTS[43] = "cb"
  HINTS[44] = "cc"
  HINTS[45] = "cd"
  HINTS[46] = "cf"
  HINTS[47] = "cg"
  HINTS[48] = "ch"
  HINTS[49] = "cm"
  HINTS[50] = "cn"
  HINTS[51] = "cq"
  HINTS[52] = "cs"
  HINTS[53] = "cv"
  HINTS[54] = "cw"
  HINTS[55] = "cx"
  HINTS[56] = "cy"
  HINTS[57] = "cz"
  HINTS[58] = "da"
  HINTS[59] = "db"
  HINTS[60] = "dc"
  HINTS[61] = "dd"
  HINTS[62] = "df"
  HINTS[63] = "dg"
  HINTS[64] = "dh"
  HINTS[65] = "dm"
  HINTS[66] = "dn"
  HINTS[67] = "dq"
  HINTS[68] = "ds"
  HINTS[69] = "dv"
  HINTS[70] = "dw"
  HINTS[71] = "dx"
  HINTS[72] = "dy"
  HINTS[73] = "dz"
  HINTS[74] = "fa"
  HINTS[75] = "fb"
  HINTS[76] = "fc"
  HINTS[77] = "fd"
  HINTS[78] = "ff"
  HINTS[79] = "fg"
  HINTS[80] = "fh"
  HINTS[81] = "fm"
  HINTS[82] = "fn"
  HINTS[83] = "fq"
  HINTS[84] = "fs"
  HINTS[85] = "fv"
  HINTS[86] = "fw"
  HINTS[87] = "fx"
  HINTS[88] = "fy"
  HINTS[89] = "fz"
  HINTS[90] = "ga"
  HINTS[91] = "gb"
  HINTS[92] = "gc"
  HINTS[93] = "gd"
  HINTS[94] = "gf"
  HINTS[95] = "gg"
  HINTS[96] = "gh"
  HINTS[97] = "gm"
  HINTS[98] = "gn"
  HINTS[99] = "gq"
  HINTS[100] = "gs"
  HINTS[101] = "gv"
  HINTS[102] = "gw"
  HINTS[103] = "gx"
  HINTS[104] = "gy"
  HINTS[105] = "gz"
  HINTS[106] = "ha"
  HINTS[107] = "hb"
  HINTS[108] = "hc"
  HINTS[109] = "hd"
  HINTS[110] = "hf"
  HINTS[111] = "hg"
  HINTS[112] = "hh"
  HINTS[113] = "hm"
  HINTS[114] = "hn"
  HINTS[115] = "hq"
  HINTS[116] = "hs"
  HINTS[117] = "hv"
  HINTS[118] = "hw"
  HINTS[119] = "hx"
  HINTS[120] = "hy"
  HINTS[121] = "hz"
  HINTS[122] = "ma"
  HINTS[123] = "mb"
  HINTS[124] = "mc"
  HINTS[125] = "md"
  HINTS[126] = "mf"
  HINTS[127] = "mg"
  HINTS[128] = "mh"
  HINTS[129] = "mm"
  HINTS[130] = "mn"
  HINTS[131] = "mq"
  HINTS[132] = "ms"
  HINTS[133] = "mv"
  HINTS[134] = "mw"
  HINTS[135] = "mx"
  HINTS[136] = "my"
  HINTS[137] = "mz"
  HINTS[138] = "na"
  HINTS[139] = "nb"
  HINTS[140] = "nc"
  HINTS[141] = "nd"
  HINTS[142] = "nf"
  HINTS[143] = "ng"
  HINTS[144] = "nh"
  HINTS[145] = "nm"
  HINTS[146] = "nn"
  HINTS[147] = "nq"
  HINTS[148] = "ns"
  HINTS[149] = "nv"
  HINTS[150] = "nw"
  HINTS[151] = "nx"
  HINTS[152] = "ny"
  HINTS[153] = "nz"
  HINTS[154] = "qa"
  HINTS[155] = "qb"
  HINTS[156] = "qc"
  HINTS[157] = "qd"
  HINTS[158] = "qf"
  HINTS[159] = "qg"
  HINTS[160] = "qh"
  HINTS[161] = "qm"
  HINTS[162] = "qn"
  HINTS[163] = "qq"
  HINTS[164] = "qs"
  HINTS[165] = "qv"
  HINTS[166] = "qw"
  HINTS[167] = "qx"
  HINTS[168] = "qy"
  HINTS[169] = "qz"
  HINTS[170] = "sa"
  HINTS[171] = "sb"
  HINTS[172] = "sc"
  HINTS[173] = "sd"
  HINTS[174] = "sf"
  HINTS[175] = "sg"
  HINTS[176] = "sh"
  HINTS[177] = "sm"
  HINTS[178] = "sn"
  HINTS[179] = "sq"
  HINTS[180] = "ss"
  HINTS[181] = "sv"
  HINTS[182] = "sw"
  HINTS[183] = "sx"
  HINTS[184] = "sy"
  HINTS[185] = "sz"
  HINTS[186] = "va"
  HINTS[187] = "vb"
  HINTS[188] = "vc"
  HINTS[189] = "vd"
  HINTS[190] = "vf"
  HINTS[191] = "vg"
  HINTS[192] = "vh"
  HINTS[193] = "vm"
  HINTS[194] = "vn"
  HINTS[195] = "vq"
  HINTS[196] = "vs"
  HINTS[197] = "vv"
  HINTS[198] = "vw"
  HINTS[199] = "vx"
  HINTS[200] = "vy"
  HINTS[201] = "vz"
  HINTS[202] = "wa"
  HINTS[203] = "wb"
  HINTS[204] = "wc"
  HINTS[205] = "wd"
  HINTS[206] = "wf"
  HINTS[207] = "wg"
  HINTS[208] = "wh"
  HINTS[209] = "wm"
  HINTS[210] = "wn"
  HINTS[211] = "wq"
  HINTS[212] = "ws"
  HINTS[213] = "wv"
  HINTS[214] = "ww"
  HINTS[215] = "wx"
  HINTS[216] = "wy"
  HINTS[217] = "wz"
  HINTS[218] = "xa"
  HINTS[219] = "xb"
  HINTS[220] = "xc"
  HINTS[221] = "xd"
  HINTS[222] = "xf"
  HINTS[223] = "xg"
  HINTS[224] = "xh"
  HINTS[225] = "xm"
  HINTS[226] = "xn"
  HINTS[227] = "xq"
  HINTS[228] = "xs"
  HINTS[229] = "xv"
  HINTS[230] = "xw"
  HINTS[231] = "xx"
  HINTS[232] = "xy"
  HINTS[233] = "xz"
  HINTS[234] = "ya"
  HINTS[235] = "yb"
  HINTS[236] = "yc"
  HINTS[237] = "yd"
  HINTS[238] = "yf"
  HINTS[239] = "yg"
  HINTS[240] = "yh"
  HINTS[241] = "ym"
  HINTS[242] = "yn"
  HINTS[243] = "yq"
  HINTS[244] = "ys"
  HINTS[245] = "yv"
  HINTS[246] = "yw"
  HINTS[247] = "yx"
  HINTS[248] = "yy"
  HINTS[249] = "yz"
  HINTS[250] = "za"
  HINTS[251] = "zb"
  HINTS[252] = "zc"
  HINTS[253] = "zd"
  HINTS[254] = "zf"
  HINTS[255] = "zg"
  HINTS[256] = "zh"
  HINTS[257] = "zm"
  HINTS[258] = "zn"
  HINTS[259] = "zq"
  HINTS[260] = "zs"
  HINTS[261] = "zv"
  HINTS[262] = "zw"
  HINTS[263] = "zx"
  HINTS[264] = "zy"
  HINTS[265] = "zz"
  #HINTS[0] = "p"
  #HINTS[1] = "o"
  #HINTS[2] = "i"
  #HINTS[3] = "u"
  #HINTS[4] = "l"
  #HINTS[5] = "k"
  #HINTS[6] = "j"
  #HINTS[7] = "t"
  #HINTS[8] = "r"
  #HINTS[9] = "e"
  #HINTS[10] = "wj"
  #HINTS[11] = "wt"
  #HINTS[12] = "wr"
  #HINTS[13] = "we"
  #HINTS[14] = "ww"
  #HINTS[15] = "wq"
  #HINTS[16] = "wf"
  #HINTS[17] = "wd"
  #HINTS[18] = "ws"
  #HINTS[19] = "wa"
  #HINTS[20] = "qp"
  #HINTS[21] = "qo"
  #HINTS[22] = "qi"
  #HINTS[23] = "qu"
  #HINTS[24] = "ql"
  #HINTS[25] = "qk"
  #HINTS[26] = "qj"
  #HINTS[27] = "qt"
  #HINTS[28] = "qr"
  #HINTS[29] = "qe"
  #HINTS[30] = "qw"
  #HINTS[31] = "qq"
  #HINTS[32] = "qf"
  #HINTS[33] = "qd"
  #HINTS[34] = "qs"
  #HINTS[35] = "qa"
  #HINTS[36] = "fp"
  #HINTS[37] = "fo"
  #HINTS[38] = "fi"
  #HINTS[39] = "fu"
  #HINTS[40] = "fl"
  #HINTS[41] = "fk"
  #HINTS[42] = "fj"
  #HINTS[43] = "ft"
  #HINTS[44] = "fr"
  #HINTS[45] = "fe"
  #HINTS[46] = "fw"
  #HINTS[47] = "fq"
  #HINTS[48] = "ff"
  #HINTS[49] = "fd"
  #HINTS[50] = "fs"
  #HINTS[51] = "fa"
  #HINTS[52] = "dp"
  #HINTS[53] = "do"
  #HINTS[54] = "di"
  #HINTS[55] = "du"
  #HINTS[56] = "dl"
  #HINTS[57] = "dk"
  #HINTS[58] = "dj"
  #HINTS[59] = "dt"
  #HINTS[60] = "dr"
  #HINTS[61] = "de"
  #HINTS[62] = "dw"
  #HINTS[63] = "dq"
  #HINTS[64] = "df"
  #HINTS[65] = "dd"
  #HINTS[66] = "ds"
  #HINTS[67] = "da"
  #HINTS[68] = "sp"
  #HINTS[69] = "so"
  #HINTS[70] = "si"
  #HINTS[71] = "su"
  #HINTS[72] = "sl"
  #HINTS[73] = "sk"
  #HINTS[74] = "sj"
  #HINTS[75] = "st"
  #HINTS[76] = "sr"
  #HINTS[77] = "se"
  #HINTS[78] = "sw"
  #HINTS[79] = "sq"
  #HINTS[80] = "sf"
  #HINTS[81] = "sd"
  #HINTS[82] = "ss"
  #HINTS[83] = "sa"
  #HINTS[84] = "ap"
  #HINTS[85] = "ao"
  #HINTS[86] = "ai"
  #HINTS[87] = "au"
  #HINTS[88] = "al"
  #HINTS[89] = "ak"
  #HINTS[90] = "aj"
  #HINTS[91] = "at"
  #HINTS[92] = "ar"
  #HINTS[93] = "ae"
  #HINTS[94] = "aw"
  #HINTS[95] = "aq"
  #HINTS[96] = "af"
  #HINTS[97] = "ad"
  #HINTS[98] = "as"
  #HINTS[99] = "aa"
  #HINTS[100] = "bp"
  #HINTS[101] = "bo"
  #HINTS[102] = "bi"
  #HINTS[103] = "bu"
  #HINTS[104] = "bl"
  #HINTS[105] = "bk"
  #HINTS[106] = "bj"
  #HINTS[107] = "bt"
  #HINTS[108] = "br"
  #HINTS[109] = "be"
  #HINTS[110] = "bw"
  #HINTS[111] = "bq"
  #HINTS[112] = "bf"
  #HINTS[113] = "bd"
  #HINTS[114] = "bs"
  #HINTS[115] = "ba"



  finger_patterns = ENVIRON["FINGERS_PATTERNS"];
  fingers_compact_hints = ENVIRON["FINGERS_COMPACT_HINTS"];

  if (fingers_compact_hints)
    fingers_hint_position = ENVIRON["FINGERS_HINT_POSITION"];
  else
    fingers_hint_position = ENVIRON["FINGERS_HINT_POSITION_NOCOMPACT"];

  if (fingers_compact_hints) {
    hint_format = ENVIRON["FINGERS_HINT_FORMAT"]
    hint_format_nocolor = ENVIRON["FINGERS_HINT_FORMAT_NOCOLOR"]
    highlight_format = ENVIRON["FINGERS_HIGHLIGHT_FORMAT"]
    highlight_format_nocolor = ENVIRON["FINGERS_HIGHLIGHT_FORMAT_NOCOLOR"]
  } else {
    hint_format = ENVIRON["FINGERS_HINT_FORMAT_NOCOMPACT"]
    highlight_format = ENVIRON["FINGERS_HIGHLIGHT_FORMAT_NOCOMPACT"]
    hint_format_nocolor = ENVIRON["FINGERS_HINT_FORMAT_NOCOMPACT_NOCOLOR"]
    highlight_format_nocolor = ENVIRON["FINGERS_HIGHLIGHT_FORMAT_NOCOMPACT_NOCOLOR"]
  }

  if (fingers_hint_position == "left")
    compound_format = hint_format highlight_format
  else
    compound_format = highlight_format hint_format

  hint_lookup = ""
}

{
  output_line = $0;

  # insert hints into `output_line` and accumulate hints in `hint_lookup`
  line = output_line;
  pos = col_pos_correction = 0;
  while (match(line, finger_patterns)) {
    pos += RSTART;
    col_pos = pos + col_pos_correction
    pre_match = substr(output_line, 0, col_pos - 1);
    post_match = substr(output_line, col_pos + RLENGTH, length(line) - 1);
    line_match = substr(line, RSTART, RLENGTH);

    hint = hint_by_match[line_match]
    if (!hint) {
      hint = HINTS[n_matches++]
      hint_by_match[line_match] = hint
    }
    hint_lookup = hint_lookup hint ":" line_match "\n"

    if (fingers_compact_hints) {
      hint_len = length(sprintf(hint_format_nocolor, hint))

      if (fingers_hint_position == "left")
        line_match = substr(line_match, hint_len + 1, length(line_match) - hint_len);
      else
        line_match = substr(line_match, 1, length(line_match) - hint_len);
    }

    if (fingers_hint_position == "left")
      hint_match = sprintf(compound_format, hint, line_match);
    else
      hint_match = sprintf(compound_format, line_match, hint);

    output_line = pre_match hint_match post_match;

    col_pos_correction += length(sprintf(highlight_format, line_match)) + length(sprintf(hint_format, hint)) - 1;

    line = post_match;
  }

  printf "\n%s", output_line
}

END {
  print hint_lookup | "cat 1>&3"
}
